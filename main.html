<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DYFI-Digital Signature</title>
<!-- Load Signature Pad and jsPDF libraries -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    /* Basic Styling for Mobile-First Design */
    body { 
        font-family: 'Inter', Arial, sans-serif; 
        background: #f4f7f9; 
        text-align: center; 
        padding: 15px; 
        color: #333;
    }
    
    /* Input Fields & Select */
    input, select {
        width: 90%; 
        max-width: 400px; 
        padding: 14px; 
        margin: 10px 0; 
        border: 1px solid #ccc; 
        border-radius: 8px; 
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        transition: border-color 0.3s;
        /* Ensure select has the same height as inputs */
        -webkit-appearance: none; 
        -moz-appearance: none; 
        appearance: none; 
        background-color: white; 
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23000%22%20d%3D%22M287%2069.9L146.2%20210.6%205.4%2069.9z%22%2F%3E%3C%2Fsvg%3E'); /* Custom dropdown arrow */
        background-repeat: no-repeat;
        background-position: right 10px top 50%;
        background-size: 10px auto;
    }
    input:focus, select:focus {
        border-color: #1a73e8;
        outline: none;
    }
    select:invalid {
        color: #999; /* Placeholder color for unselected option */
    }

    /* Signature Box Container */
    #box { 
        width: 95%; 
        max-width: 800px; 
        height: 50vh; 
        border: 2px solid #333; 
        background: white; 
        position: relative; 
        margin: 15px auto;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    
    /* Canvas element fills the box */
    canvas { 
        width: 100%; 
        height: 100%; 
        display: block; 
    }
    
    /* Buttons Styling */
    button { 
        padding: 12px 24px; 
        margin: 8px; 
        color: white; 
        border: none; 
        border-radius: 8px; 
        cursor: pointer; 
        font-size: 16px;
        font-weight: 600;
        transition: background-color 0.3s, transform 0.1s;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    button:hover:not(:disabled) {
        transform: translateY(-1px);
        opacity: 0.9;
    }
    button:disabled { 
        background: #999; 
        cursor: not-allowed; 
        box-shadow: none;
    }
    
    /* Specific Button Colors */
    #save { background: #0a8f08; } /* Green for Send */
    #clear { background: #d32f2f; } /* Red for Clear */
    #pdfMenuBtn { background: #1a73e8; } /* Blue for Menu */

    /* Popup for PDF options (keeping for consistency, though download/preview still works) */
    #pdfMenu { 
        display: none; 
        margin: 10px auto; 
        width: 90%;
        max-width: 280px;
        background: #fff; 
        padding: 15px; 
        border-radius: 12px; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
        border: 1px solid #eee;
    }
    #pdfMenu button { 
        width: 100%; 
        margin: 5px 0; 
        background: #444; 
    }

    /* Message Box for alerts (instead of native alerts) */
    .message-box {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        visibility: hidden;
        opacity: 0;
        transition: visibility 0s, opacity 0.3s;
    }
    .message-box.active {
        visibility: visible;
        opacity: 1;
    }
    .message-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        max-width: 300px;
        text-align: center;
        transform: scale(0.9);
        transition: transform 0.3s;
    }
    .message-box.active .message-content {
        transform: scale(1);
    }
    .message-content button {
        background: #1a73e8;
        margin-top: 15px;
    }
</style>
</head>
<body>

<h3>DYFI நடத்தும் 1-லட்சம் TNPSC பணியிடங்களை நிரப்பக் கோரி கையெழுத்து இயக்கம் E-Signature </h3>
<p>Sign the box below and submit your details.</p>

<!-- Input Fields -->
<input id="name" placeholder="Enter Your Name">
<input id="number" type="number" placeholder="Enter Your Phone Number">

<!-- Native Place Select Dropdown -->
<select id="district" required>
    <option value="" disabled selected>Choose Your District</option>
    <option value="Ariyalur">அரியலூர் - Ariyalur</option>
    <option value="Chengalpattu">செங்கல்பட்டு - Chengalpattu</option>
    <option value="Chennai">சென்னை - Chennai</option>
    <option value="Coimbatore">கோயம்புத்தூர் - Coimbatore</option>
    <option value="Cuddalore">கடலூர் - Cuddalore</option>
    <option value="Dharmapuri">தருமபுரி - Dharmapuri</option>
    <option value="Dindigul">திண்டுக்கல் - Dindigul</option>
    <option value="Erode">ஈரோடு - Erode</option>
    <option value="Kallakurichi">கள்ளக்குறிச்சி - Kallakurichi</option>
    <option value="Kancheepuram">காஞ்சிபுரம் - Kancheepuram</option>
    <option value="Kanyakumari">கன்னியாகுமரி - Kanyakumari</option>
    <option value="Karur">கரூர் - Karur</option>
    <option value="Krishnagiri">கிருஷ்ணகிரி - Krishnagiri</option>
    <option value="Madurai">மதுரை - Madurai</option>
    <option value="Mayiladuthurai">மயிலாடுதுறை - Mayiladuthurai</option>
    <option value="Nagapattinam">நாகப்பட்டினம் - Nagapattinam</option>
    <option value="Namakkal">நாமக்கல் - Namakkal</option>
    <option value="Nilgiris">நீலகிரி - Nilgiris</option>
    <option value="Perambalur">பெரம்பலூர் - Perambalur</option>
    <option value="Pudukkottai">புதுக்கோட்டை - Pudukkottai</option>
    <option value="Ramanathapuram">இராமநாதபுரம் - Ramanathapuram</option>
    <option value="Ranipet">இராணிப்பேட்டை - Ranipet</option>
    <option value="Salem">சேலம் - Salem</option>
    <option value="Sivaganga">சிவகங்கை - Sivaganga</option>
    <option value="Tenkasi">தென்காசி - Tenkasi</option>
    <option value="Thanjavur">தஞ்சாவூர் - Thanjavur</option>
    <option value="Theni">தேனி - Theni</option>
    <option value="Thoothukudi">தூத்துக்குடி - Thoothukudi</option>
    <option value="Tiruchirappalli">திருச்சிராப்பள்ளி - Tiruchirappalli</option>
    <option value="Tirunelveli">திருநெல்வேலி - Tirunelveli</option>
    <option value="Tirupattur">திருப்பத்தூர் - Tirupattur</option>
    <option value="Tiruppur">திருப்பூர் - Tiruppur</option>
    <option value="Tiruvallur">திருவள்ளூர் - Tiruvallur</option>
    <option value="Tiruvannamalai">திருவண்ணாமலை - Tiruvannamalai</option>
    <option value="Tiruvarur">திருவாரூர் - Tiruvarur</option>
    <option value="Vellore">வேலூர் - Vellore</option>
    <option value="Viluppuram">விழுப்புரம் - Viluppuram</option>
    <option value="Virudhunagar">விருதுநகர் - Virudhunagar</option>
</select>


<div id="box">
    <canvas id="canvas"></canvas>
</div>

<div class="flex-row">
    <button id="clear">Clear Signature</button>
    <!-- Kept PDF menu but changed the text on the main send button -->
    <button id="pdfMenuBtn">View/Download PDF</button> 
</div>

<div id="pdfMenu">
    <button id="previewBtn">Preview PDF</button>
    <button id="downloadBtn">Download PDF</button>
</div>

<button id="save">Submit Details </button>

<!-- Custom Message Box for Mobile Friendly Alerts -->
<div id="messageBox" class="message-box">
    <div class="message-content">
        <p id="messageText"></p>
        <button onclick="document.getElementById('messageBox').classList.remove('active')">OK</button>
    </div>
</div>

<script>
    // --- Utility Function: Custom Alert/Message Box ---
    function showMessage(text) {
        document.getElementById('messageText').innerHTML = text; // Use innerHTML for bold text
        document.getElementById('messageBox').classList.add('active');
    }

    // 1. Initialize Canvas & SignaturePad
    const canvas = document.getElementById("canvas");
    const box = document.getElementById("box");
    let signaturePad;

    // Function to handle canvas resizing and maintain signature aspect ratio
    function resizeCanvas() {
        const data = signaturePad ? signaturePad.toData() : null;
        
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = box.clientWidth * ratio;
        canvas.height = box.clientHeight * ratio;
        canvas.getContext("2d").scale(ratio, ratio);
        
        if (!signaturePad) {
            // Initialize SignaturePad
            signaturePad = new SignaturePad(canvas, { backgroundColor: "transparent", penColor: "blue" });
        } else {
            signaturePad.clear();
            // Restore data after resize
            if (data && data.length > 0) {
                signaturePad.fromData(data);
            }
        }
    }
    
    // Initialize and listen for resize events
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas(); // Initial call to set size

    document.getElementById("clear").onclick = () => signaturePad.clear();

    // 2. Core PDF Generation Function (KEPT for Preview/Download buttons)
    async function createPDF() {
        try {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF("landscape", "pt", "a4"); 
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();

            const name = document.getElementById("name").value.trim() || "Unsigned User";
            const district = document.getElementById("district").value || "Not Selected"; 
            
            // --- PDF CONTENT ---
            
            pdf.setFontSize(22);
            pdf.text(" el¤J« 1-y£r« gâæl§fis ãu¥g¡ nfhç ifbaG¤J Ïa¡f«", 40, 40);
            
            pdf.setFontSize(14);
            pdf.text(`Document signed by: ${name}`, 40, 65);
            pdf.text(`District: ${district}`, 40, 85); 
            pdf.text(`Date: ${new Date().toLocaleString()}`, 40, 105); 
            
            // Add Rectangle Border for Signature Area
            const signAreaY = 120; 
            const signAreaHeight = 380; 
            pdf.setLineWidth(2);
            pdf.setDrawColor(50, 50, 50); 
            pdf.rect(40, signAreaY, pdfWidth - 80, signAreaHeight); 

            // Add Signature (if present)
            if (!signaturePad.isEmpty()) {
                const imgData = signaturePad.toDataURL("image/png");
                pdf.addImage(imgData, "PNG", 40, signAreaY, pdfWidth - 80, signAreaHeight);
            } else {
                pdf.setFontSize(18);
                pdf.setTextColor(150);
                pdf.text("NO SIGNATURE PROVIDED", pdfWidth / 2, pdfHeight / 2, { align: 'center' });
                pdf.setTextColor(0);
            }

            return pdf.output("blob");

        } catch (error) {
            console.error("PDF Generation Error:", error);
            showMessage("Error generating PDF: " + error.message);
            return null;
        }
    }

    // 3. Toggle PDF Menu
    document.getElementById("pdfMenuBtn").onclick = () => {
        const menu = document.getElementById("pdfMenu");
        if (menu.style.display === "block") {
            menu.style.display = "none";
        } else {
            menu.style.display = "block";
        }
    };

    // 4. Preview Function
    document.getElementById("previewBtn").onclick = async () => {
        const pdfBlob = await createPDF();
        if (pdfBlob) {
            const url = URL.createObjectURL(pdfBlob);
            window.open(url, "_blank");
        }
    };

    // 5. Download Function
    document.getElementById("downloadBtn").onclick = async () => {
        const pdfBlob = await createPDF();
        if (pdfBlob) {
            const url = URL.createObjectURL(pdfBlob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `Signed_Document_${new Date().toISOString().slice(0, 10)}.pdf`;
            a.click();
        }
    };

    // 6. Web3Forms Email Function (UPDATED: Sends only Text Data)
    document.getElementById("save").onclick = async () => {
        const name = document.getElementById("name").value.trim();
        const number = document.getElementById("number").value.trim();
        const district = document.getElementById("district").value;
        const btn = document.getElementById("save");

        // --- Validation ---
        if (!name) return showMessage("Please enter your **Name**.");
        if (!number) return showMessage("Please enter your **Phone Number**.");
        if (!district) return showMessage("Please select your **District**.");
        if (signaturePad.isEmpty()) return showMessage("Please **sign** the document before submitting."); 

        // UI Feedback during process
        btn.innerText = "Submitting...";
        btn.disabled = true;

        // *** NOTE: We skip PDF generation and attachment here ***
        
        const formData = new FormData();
        
        // 1. Access Key (Required for Web3Forms)
        formData.append("access_key", "6e1efc51-93b3-4ffc-8d33-a446ca6eacd8"); 
        
        // 2. Subject and User Fields (Using explicit labels for clarity in the received email)
        formData.append("subject", `New Signature Submission from ${name} (${district})`); 
        formData.append("Name", name); 
        formData.append("Phone Number", number); 
        formData.append("District", district); 
        
        formData.append("message", `New signature details received.For new dyfi member.`);

        try {
            const response = await fetch("https://api.web3forms.com/submit", {
                method: "POST",
                body: formData
            });

            const result = await response.json();
            
            if (result.success) {
                showMessage(`Success! Your details have been submitted. Thank you for signing!`);
                
                // Clear the form for the next user
                document.getElementById("name").value = "";
                document.getElementById("number").value = "";
                document.getElementById("district").value = "";
                signaturePad.clear();
                document.getElementById("pdfMenu").style.display = "none";
            } else {
                showMessage(`Error submitting details: ${result.message}`);
                console.error("Web3Forms API Error:", result);
            }
        } catch (error) {
            showMessage("Network Error: Could not connect to the API.");
            console.error("Fetch Error:", error);
        } finally {
            // Reset UI
            btn.innerText = "Submit Details "; 
            btn.disabled = false;
        }
    };
</script>

</body>
</html>

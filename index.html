<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Signature PDF + Mail</title>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background:#f1f1f1; text-align:center; padding:15px; }
#box { width:100%; height:60vh; background:white; border:2px solid black; }
canvas { width:100%; height:100%; }
input { width:90%; padding:12px; margin:10px 0; border:1px solid #777; border-radius:6px;}
button { padding:12px 20px; margin:8px; background:#333; color:white; border:none; border-radius:8px;}
#save { background:#0a8f08; }
#clear { background:#d32f2f; }
#pdfMenuBtn { background:#1a73e8; }
#pdfMenu { display:none; margin:auto; width:220px; background:#fff; padding:10px; border-radius:10px; box-shadow:0 0 10px #999;}
#pdfMenu button { width:100%; margin:5px 0; background:#444; }
</style>
</head>
<body>
<h2>Digital Signature System</h2>
<input id="name" placeholder="Enter Your Name">
<input id="email" type="email" placeholder="Enter Email">
<div id="box"><canvas id="canvas"></canvas></div>
<button id="clear">Clear</button>
<button id="pdfMenuBtn">PDF Options</button>
<div id="pdfMenu">
    <button id="previewBtn">Preview PDF</button>
    <button id="downloadBtn">Download PDF</button>
</div>
<button id="save">Save & Send Email</button>

<script>
const canvas = document.getElementById("canvas");
const box = document.getElementById("box");
function resizeCanvas(){
    const ratio = window.devicePixelRatio || 1;
    canvas.width = box.clientWidth * ratio;
    canvas.height = box.clientHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

const signaturePad = new SignaturePad(canvas,{backgroundColor:"white",penColor:"blue"});
document.getElementById("clear").onclick = ()=>signaturePad.clear();

async function createPDF(){
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("landscape","pt","a4");
    const name = document.getElementById("name").value.trim();
    pdf.setFontSize(18);
    pdf.text(`I am the ${name}`,40,40);
    const img = signaturePad.toDataURL("image/png");
    pdf.addImage(img,"PNG",40,80,760,450);
    return pdf;
}

document.getElementById("pdfMenuBtn").onclick = ()=>{
    const menu=document.getElementById("pdfMenu");
    menu.style.display=menu.style.display==="block"?"none":"block";
};

document.getElementById("previewBtn").onclick=async ()=>{
    if(signaturePad.isEmpty())return alert("Please sign first!");
    const pdf = await createPDF();
    const blob = pdf.output("blob");
    const url = URL.createObjectURL(blob);
    window.open(url,"_blank");
};

document.getElementById("downloadBtn").onclick=async ()=>{
    if(signaturePad.isEmpty())return alert("Please sign first!");
    const pdf = await createPDF();
    pdf.save("signature.pdf");
};

document.getElementById("save").onclick=async ()=>{
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    if(!name)return alert("Enter Name");
    if(!email)return alert("Enter Email");
    if(signaturePad.isEmpty())return alert("Sign first!");
    const pdf = await createPDF();
    const pdfBlob = pdf.output("blob");

    // Upload PDF to temporary host (File.io)
    const fd = new FormData();
    fd.append("file", pdfBlob, "signature.pdf");
    const response = await fetch("https://file.io/?expires=1w", {method:"POST", body:fd});
    const result = await response.json();
    if(!result.success)return alert("PDF upload failed");

    const pdfURL = result.link;

    // Send mail via Web3Forms
    const formData = new FormData();
    formData.append("access_key","6e1efc51-93b3-4ffc-8d33-a446ca6eacd8");
    formData.append("subject","New Signature PDF");
    formData.append("name",name);
    formData.append("email",email);
    formData.append("message",`Here is your signature PDF: ${pdfURL}`);
    formData.append("redirect","https://web3forms.com/success");

    const mailResp = await fetch("https://api.web3forms.com/submit",{method:"POST",body:formData});
    const mailResult = await mailResp.json();
    if(mailResult.success) alert("PDF uploaded & mail sent!");
    else alert("Mail failed: "+mailResult.message);
};
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Signature + Web3Forms Mail</title>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; text-align:center; background:#eee; padding:15px; }
#box { width:100%; height:60vh; background:white; border:2px solid black; }
canvas { width:100%; height:100%; }
input { width:90%; padding:12px; margin:10px 0; border:1px solid #777; border-radius:6px;}
button { padding:12px 22px; margin:10px; background:#333; color:white; border:none; border-radius:8px; }
#save { background:#0a8f08; }
#clear { background:#d32f2f; }
</style>
</head>

<body>

<h2>Signature System — Web3Forms Email</h2>

<input id="name" placeholder="Enter Your Name">
<input id="email" type="email" placeholder="Enter Email">

<div id="box">
    <canvas id="canvas"></canvas>
</div>

<button id="clear">Clear</button>
<button id="save">Save & Send Email</button>

<script>
/* ---------------- Canvas Setup ---------------- */
const canvas = document.getElementById("canvas");
const box = document.getElementById("box");

function resizeCanvas() {
    const ratio = window.devicePixelRatio || 1;
    canvas.width = box.clientWidth * ratio;
    canvas.height = box.clientHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

const signaturePad = new SignaturePad(canvas, {
    backgroundColor: "white",
    penColor: "blue"
});

document.getElementById("clear").onclick = () => signaturePad.clear();

/* ---------------- Save & Send Mail ---------------- */
document.getElementById("save").onclick = async () => {

    let name = document.getElementById("name").value.trim();
    let email = document.getElementById("email").value.trim();

    if (!name) return alert("Enter Name");
    if (!email) return alert("Enter Email");
    if (signaturePad.isEmpty()) return alert("Sign first!");

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("landscape", "pt", "a4");

    pdf.setFontSize(18);
    pdf.text(`I am the ${name}`, 40, 40);

    const imgData = signaturePad.toDataURL("image/png");
    pdf.addImage(imgData, "PNG", 40, 80, 760, 450);

    const pdfBlob = pdf.output("blob");

    // Convert Blob → Base64
    const base64 = await blobToBase64(pdfBlob);

    // Send to Web3Forms API
    const formData = new FormData();
    formData.append("access_key", "da58c48c-c03a-4753-864c-3c121fb9cf1b");
    formData.append("subject", "New Signature PDF");
    formData.append("name", name);
    formData.append("email", email);
    formData.append("pdf_base64", base64);

    const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        body: formData
    });

    const result = await response.json();

    if (result.success) {
        alert("PDF Sent Successfully!");
    } else {
        alert("Error sending mail: " + result.message);
        console.log(result);
    }

};

// Blob → Base64
function blobToBase64(blob) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(blob);
    });
}
</script>

</body>
</html>
